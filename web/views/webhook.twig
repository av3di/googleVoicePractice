{% extends "layout.html" %}

{% block content %}
<?php
header('Content-type: application/json');

// php://input contains raw data, POST can only handle simple key value
// whereas input can handle more complicated such as nested arrays, etc
$body = file_get_contents("php://input");
$webhook = json_decode($body, true);

// What pokemon did the user guess?
$guesses = $webhook['result']['parameters']['pokemon'];
$correct = false;
foreach ($guesses as $pokemon_guess) {
  if(strcasecmp($pokemon_guess, 'bulbasaur')) {
    // User guessed the correct pokemon
    $response = {
      "speech": "That's correct!",
      "displayText": "That's correct!",
      "data": {},
      "contextOut": [],
      "source": "beinspired"
    }
    $correct = true;
  }
}

// User guess the wrong pokemon
if(!$correct){
  $response = {
    "speech": "Nope, guess again!",
    "displayText": "Nope, guess again!",
    "data": {},
    "contextOut": [],
    "source": "beinspired"
  }
}

exit(json_encode($response);
?>
{% endblock %}
